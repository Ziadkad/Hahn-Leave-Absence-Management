<div class="p-4">
  <div class="flex items-center justify-between mb-3">
    <h2 class="text-lg font-semibold text-slate-800">My Leaves Calendar</h2>

      <span class="inline-flex items-center rounded-full bg-emerald-100 text-emerald-700 px-2.5 py-0.5 text-xs font-semibold">
        Leaves left: {{ leavesLeft }} days
      </span>
  </div>
  <!-- Compact create form -->
  <form [formGroup]="createForm"  (ngSubmit)="onCreateSubmit()" class="mb-3">
    <div class="grid grid-cols-1 md:grid-cols-12 gap-3 items-end">
      <!-- Type (required) -->
      <div class="md:col-span-3">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">Type</label>
        <select
          formControlName="type"
          class="w-full h-9 rounded-md border border-slate-300 bg-white px-2 text-sm outline-none
               focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
          [disabled]="isSubmitting"
          required
        >
          <option [ngValue]="null" disabled>Select type…</option>
          <option *ngFor="let k of leaveTypeOptions" [ngValue]="LeaveType[k]">
            {{ k }}
          </option>
        </select>
          <!-- Type field error -->
          <p *ngIf="createForm.hasError('required', 'type') && createForm.get('type')?.touched"
             class="text-xs text-rose-600 mt-1">
            Type is required.
          </p>
      </div>

      <!-- Description (optional) -->
      <div class="md:col-span-5">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">Description (optional)</label>
        <input
          type="text"
          formControlName="description"
          class="w-full h-9 rounded-md border border-slate-300 bg-white px-2 text-sm outline-none
               focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
          maxlength="500"
          [disabled]="isSubmitting"
          placeholder="e.g., Family trip"
        />

      </div>

      <!-- Selected Range (read-only chips) -->
      <div class="md:col-span-3">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">Selected range</label>
        <div class="flex items-center gap-2">
          <span class="inline-flex items-center rounded-full bg-emerald-50 text-emerald-700 px-2 py-0.5 text-xs font-medium"
                *ngIf="createForm.value.startDate">
            {{ (createForm.value.startDate | date:'yyyy-MM-dd') }}
          </span>
          <span class="text-slate-500" *ngIf="createForm.value.startDate && createForm.value.endDate">→</span>
          <span class="inline-flex items-center rounded-full bg-emerald-50 text-emerald-700 px-2 py-0.5 text-xs font-medium"
                *ngIf="createForm.value.endDate">
            {{ (createForm.value.endDate | date:'yyyy-MM-dd') }}
          </span>
          <span class="text-xs text-slate-500" *ngIf="!createForm.value.startDate">drag on calendar</span>
        </div>
        <p *ngIf="(createForm.hasError('required', 'startDate') || createForm.hasError('required', 'endDate'))
          && (createForm.get('startDate')?.touched || createForm.get('endDate')?.touched)"
           class="text-xs text-rose-600 mt-1">
          Start date and End date are required. Drag on the calendar
        </p>
      </div>

      <!-- Submit -->
      <div class="md:col-span-1 flex justify-end">
        <button
          type="submit"
          class="inline-flex h-9 items-center justify-center w-full rounded-lg bg-emerald-600 px-4 text-white text-sm font-medium hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:opacity-50"
          [disabled]="isSubmitting"
        >
          Create
        </button>
      </div>
    </div>
  </form>

  <div class="relative">
    <div *ngIf="isLoading" class="absolute inset-0 grid place-items-center bg-white/40 backdrop-blur-sm z-10">
      <div class="animate-spin h-8 w-8 border-2 border-emerald-600 border-t-transparent rounded-full"></div>
    </div>

    <full-calendar
      #calendarRef
      [options]="calendarOptions"
      class="leave-big-calendar"
    ></full-calendar>
  </div>

  <p *ngIf="errorMessage" class="mt-3 text-sm text-rose-600">{{ errorMessage }}</p>
</div>
