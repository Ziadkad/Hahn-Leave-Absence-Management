<div class="p-6">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h2 class="text-lg font-semibold text-slate-800">Leave Requests</h2>
      <p class="text-sm text-slate-500">Total: {{ totalItems }}</p>
    </div>
  </div>

  <div class="mb-4">
    <div class="grid grid-cols-1 md:grid-cols-12 gap-3">
      <!-- Row 1 -->
      <div class="md:col-span-3">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">User</label>
        <select
          class="w-full h-9 rounded-md border border-slate-300 bg-white px-2 text-sm outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
          [(ngModel)]="filters.userId"
          [disabled]="isLoading"
        >
          <option [ngValue]="undefined">All users</option>
          <option *ngFor="let u of users" [ngValue]="u.id">
            {{ u.firstName }} {{ u.lastName }}
          </option>
        </select>
      </div>


      <div class="md:col-span-3">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">Type</label>
        <select
          class="w-full h-9 rounded-md border border-slate-300 bg-white px-2 text-sm outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
          [(ngModel)]="filters.type"
          [disabled]="isLoading"
        >
          <option [ngValue]="undefined">Any</option>
          <ng-container *ngFor="let t of (LeaveType | keyvalue)">
            <option *ngIf="!isNaN(+t.key)" [ngValue]="+t.key">{{ t.value }}</option>
          </ng-container>
        </select>
      </div>

      <div class="md:col-span-3">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">Start date (from)</label>
        <input
          type="date"
          class="w-full h-9 rounded-md border border-slate-300 bg-white px-2 text-sm outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
          [ngModel]="filters.startDateFrom ? (filters.startDateFrom | date:'yyyy-MM-dd') : ''"
          (ngModelChange)="onEndDateToChange($event)"
          [disabled]="isLoading"
        />
      </div>

      <!-- Row 2 -->
      <div class="md:col-span-3">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">Start date (to)</label>
        <input
          type="date"
          class="w-full h-9 rounded-md border border-slate-300 bg-white px-2 text-sm outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
          [ngModel]="filters.startDateTo ? (filters.startDateTo | date:'yyyy-MM-dd') : ''"
          (ngModelChange)="onEndDateToChange($event)"
          [disabled]="isLoading"
        />
      </div>

      <div class="md:col-span-3">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">Status</label>
        <select
          class="w-full h-9 rounded-md border border-slate-300 bg-white px-2 text-sm outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
          [(ngModel)]="filters.status"
          [disabled]="isLoading"
        >
          <option [ngValue]="undefined">Any</option>
          <ng-container *ngFor="let s of (LeaveStatus | keyvalue)">
            <option *ngIf="!isNaN(+s.key)" [ngValue]="+s.key">{{ s.value }}</option>
          </ng-container>
        </select>
      </div>

      <div class="md:col-span-3">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">End date (from)</label>
        <input
          type="date"
          class="w-full h-9 rounded-md border border-slate-300 bg-white px-2 text-sm outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
          [ngModel]="filters.endDateFrom ? (filters.endDateFrom | date:'yyyy-MM-dd') : ''"
          (ngModelChange)="onEndDateToChange($event)"
          [disabled]="isLoading"
        />
      </div>

      <div class="md:col-span-3">
        <label class="block text-xs font-medium text-slate-700 mb-0.5">End date (to)</label>
        <input
          type="date"
          class="w-full h-9 rounded-md border border-slate-300 bg-white px-2 text-sm outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
          [ngModel]="filters.endDateTo ? (filters.endDateTo | date:'yyyy-MM-dd') : ''"
          (ngModelChange)="onEndDateToChange($event)"
          [ngModelOptions]="{ standalone: true }"
          [disabled]="isLoading"
        />
      </div>

      <!-- Actions (compact) -->
      <div class="md:col-span-3 flex items-end gap-3 w-full">
        <div class="md:col-span-3 flex items-end gap-3 w-full">
          <button (click)="applyFilters()" class="inline-flex h-9 flex-1 items-center justify-center rounded-lg bg-emerald-600 px-4 text-white text-sm font-medium hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:opacity-50">
            Apply
          </button>
          <button (click)="resetFilters()" class="inline-flex h-9 flex-1 items-center justify-center rounded-lg bg-slate-200 px-4 text-slate-700 text-sm font-medium hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:opacity-30">
            Reset
          </button>
        </div>

      </div>

    </div>
  </div>


  <!-- Page size (borderless) -->
  <div class="flex items-center gap-2 justify-end">
    <label class="text-sm text-slate-600">Page size</label>
    <select
      class="h-9 rounded-lg bg-white px-3 text-sm outline-none focus:outline-2 focus:outline-emerald-500 disabled:opacity-50"
      [(ngModel)]="pageQuery.pageSize"
      (ngModelChange)="applyFilters()"
      [disabled]="isLoading"
    >
      <option [ngValue]="10">10</option>
      <option [ngValue]="25">25</option>
      <option [ngValue]="50">50</option>
      <option [ngValue]="100">100</option>
    </select>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="text-sm text-red-600 mb-3">
    {{ errorMessage }}
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-slate-500 mb-3">Loading leave requests…</div>

  <!-- Table (no borders/shadows) -->
  <div *ngIf="!isLoading && leaveRequests?.length" class="overflow-x-auto">
    <table class="min-w-full rounded-xl overflow-hidden">
      <thead class="bg-emerald-50">
      <tr>
        <th class="px-4 py-2 text-left text-xs font-semibold tracking-wide text-emerald-700 uppercase">User</th>
        <th class="px-4 py-2 text-left text-xs font-semibold tracking-wide text-emerald-700 uppercase">Type</th>
        <th class="px-4 py-2 text-left text-xs font-semibold tracking-wide text-emerald-700 uppercase">Start</th>
        <th class="px-4 py-2 text-left text-xs font-semibold tracking-wide text-emerald-700 uppercase">End</th>
        <th class="px-4 py-2 text-left text-xs font-semibold tracking-wide text-emerald-700 uppercase">Business days</th>
        <th class="px-4 py-2 text-left text-xs font-semibold tracking-wide text-emerald-700 uppercase">Status</th>
        <th class="px-4 py-2 text-left text-xs font-semibold tracking-wide text-emerald-700 uppercase">Description</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let lr of leaveRequests" class="odd:bg-slate-50 hover:bg-emerald-50/50 transition-colors">
        <td class="px-4 py-2 text-sm text-slate-700">
          {{ lr.user.firstName }} {{ lr.user.lastName }}
        </td>
        <td class="px-4 py-2 text-sm text-slate-700">
          {{ LeaveType[lr.type] }}
        </td>
        <td class="px-4 py-2 text-sm text-slate-700">
          {{ lr.startDate | date:'mediumDate' }}
        </td>
        <td class="px-4 py-2 text-sm text-slate-700">
          {{ lr.endDate | date:'mediumDate' }}
        </td>
        <td class="px-4 py-2 text-sm text-slate-700">
          {{ lr.businessDays }}
        </td>
        <td  *ngIf="userRole == UserRole.Employee ||lr.status != LeaveStatus.Pending " class="px-4 py-2 text-sm">
            <span class="inline-flex items-center rounded-full bg-emerald-50 text-emerald-700 px-2 py-0.5 text-xs font-medium">
              {{ LeaveStatus[lr.status] }}
            </span>
        </td>
        <td *ngIf="userRole == UserRole.HumanResourcesManager && lr.status == LeaveStatus.Pending" class="px-4 py-2 text-sm">
          <select
            class="h-8 rounded-md border border-slate-300 bg-white px-2 text-xs outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:opacity-50"
            [ngModel]="lr.status"
            (ngModelChange)="onStatusChange(lr, $event)"
            [disabled]="isLoading"
          >
            <option *ngFor="let opt of leaveStatusOptions" [ngValue]="opt.value">
              {{ opt.label }}
            </option>
          </select>
        </td>

        <td class="px-4 py-2 text-sm text-slate-700">
          <div class="max-w-xs truncate" title="{{ lr.description }}">{{ lr.description == "" ? "--": lr.description }}</div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty state -->
  <div *ngIf="!isLoading && (!leaveRequests || leaveRequests.length === 0)"
       class="text-sm text-slate-500 text-center py-6">
    No leave requests found for the selected filters.
  </div>

  <!-- Pagination (text links, no borders) -->
  <div class="mt-4 flex items-center justify-between">
    <div class="text-sm text-slate-600">
      Showing
      <strong>
        {{
          totalItems === 0
            ? 0
            : ((pageQuery.page - 1) * pageQuery.pageSize + 1)
        }}
        -
        {{
          (pageQuery.page * pageQuery.pageSize) > totalItems
            ? totalItems
            : (pageQuery.page * pageQuery.pageSize)
        }}
      </strong>
      of <strong>{{ totalItems }}</strong>
    </div>

    <div class="flex items-center gap-4">
      <button
        class="text-sm text-emerald-700 hover:text-emerald-800 disabled:opacity-50"
        (click)="pageQuery.page = pageQuery.page - 1; loadLeaveRequests()"
        [disabled]="isLoading || pageQuery.page <= 1"
      >
        ← Previous
      </button>
      <div class="text-sm text-slate-600">
        Page <strong>{{ pageQuery.page }}</strong>
        of
        <strong>{{ Math.ceil(totalItems / (pageQuery.pageSize || 1)) }}</strong>
      </div>
      <button
        class="text-sm text-emerald-700 hover:text-emerald-800 disabled:opacity-50"
        (click)="pageQuery.page = pageQuery.page + 1; loadLeaveRequests()"
        [disabled]="isLoading || (pageQuery.page * pageQuery.pageSize) >= totalItems"
      >
        Next →
      </button>
    </div>
  </div>
</div>
